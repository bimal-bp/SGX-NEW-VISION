<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGX Minerals - Resource Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; }
        body { background:linear-gradient(135deg,#0c0c0c 0%,#1a1a2e 100%); color:#f0f0f0; min-height:100vh; overflow-x:hidden; }
        .container { display:flex; width:900px; height:550px; background:rgba(20,20,30,.9); border-radius:20px; overflow:hidden; box-shadow:0 15px 35px rgba(0,0,0,.5); position:relative; }
        .camera-section { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; background:linear-gradient(45deg,#0f0f1a 0%,#1a1a2e 100%); padding:20px; }
        .camera-container { width:300px; height:300px; border-radius:10px; overflow:hidden; position:relative; box-shadow:0 0 20px rgba(0,0,0,.5); }
        #cameraPreview { width:100%; height:100%; object-fit:cover; background:#2a2a4a; }
        .capture-overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.7); display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:opacity .3s ease; }
        .capture-overlay.active { opacity:1; pointer-events:auto; }
        .capture-animation { width:100px; height:100px; border:5px solid #64ff96; border-radius:50%; animation:pulse 1.5s infinite; }
        @keyframes pulse { 0%{transform:scale(.8);opacity:1} 100%{transform:scale(1.5);opacity:0} }
        .login-section { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:40px; position:relative; }
        .company-title { font-size:32px; font-weight:700; margin-bottom:10px; color:#ff8c00; text-align:center; }
        .company-subtitle { font-size:16px; color:#b0b0d0; margin-bottom:40px; text-align:center; }
        .login-form { width:100%; max-width:320px; padding:30px; background:rgba(30,30,46,.8); border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,.3); transition:box-shadow .5s ease; position:relative; z-index:2; }
        .login-form.glow { box-shadow:0 0 20px rgba(100,255,150,.5); }
        h2 { text-align:center; margin-bottom:30px; font-weight:600; color:#a0f0c0; font-size:28px; }
        .input-group { margin-bottom:20px; position:relative; }
        label { display:block; margin-bottom:8px; font-size:14px; color:#b0b0d0; }
        input { width:100%; padding:12px 15px; background:rgba(40,40,60,.8); border:1px solid #4a4a7a; border-radius:8px; color:#f0f0f0; font-size:16px; transition:all .3s ease; }
        input:focus { outline:none; border-color:#64ff96; box-shadow:0 0 10px rgba(100,255,150,.3); }
        .login-btn { width:100%; padding:12px; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); border:none; border-radius:8px; color:#1a1a2e; font-size:16px; font-weight:600; cursor:pointer; transition:all .3s ease; margin-top:10px; display:flex; justify-content:center; align-items:center; gap:8px; }
        .login-btn:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 5px 15px rgba(100,255,150,.4); }
        .login-btn:disabled { background:#555; cursor:not-allowed; opacity:0.7; }
        .forgot-password { text-align:center; margin-top:20px; }
        .forgot-password a { color:#64ff96; text-decoration:none; font-size:14px; transition:color .3s ease; }
        .forgot-password a:hover { color:#a0f0c0; text-decoration:underline; }
        .decoration { position:absolute; width:200px; height:200px; border-radius:50%; background:radial-gradient(circle,rgba(100,255,150,.1) 0%,rgba(100,255,150,0) 70%); z-index:1; }
        .decoration:nth-child(1){top:-50px;right:-50px;width:150px;height:150px;}
        .decoration:nth-child(2){bottom:-80px;left:-80px;width:200px;height:200px;}
        .camera-info { margin-top:15px; text-align:center; font-size:14px; color:#b0b0d0; }
        .location-status { margin-top:10px; text-align:center; font-size:14px; display:flex; align-items:center; justify-content:center; gap:6px; }
        .location-status i { font-size:16px; }
        .location-status.success { color:#64ff96; }
        .location-status.error { color:#ff6464; }
        .location-status.waiting { color:#b0b0d0; }
        .location-status.warning { color:#ffa500; }
        .retry-btn { margin-top:12px; padding:8px 16px; background:#64ff96; color:#1a1a2e; border:none; border-radius:6px; cursor:pointer; font-weight:600; font-size:14px; display:flex; align-items:center; gap:6px; }
        .retry-btn:hover { background:#2ecc71; }
        .spinner { width:16px; height:16px; border:2px solid #b0b0d0; border-top-color:#64ff96; border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin { to { transform:rotate(360deg); } }
        .location-options { margin-top:10px; display:flex; flex-direction:column; gap:8px; }
        .location-option { padding:8px 12px; background:rgba(40,40,60,.8); border:1px solid #4a4a7a; border-radius:6px; color:#f0f0f0; cursor:pointer; transition:all .3s ease; text-align:center; font-size:14px; }
        .location-option:hover { background:rgba(60,60,80,.8); border-color:#64ff96; }
        .location-option i { margin-right:6px; }

        /* Company Logo */
        .company-logo-container { position: absolute; top: 20px; left: 20px; display: flex; align-items: center; gap: 10px; }
        .company-logo { width: 60px; height: 60px; object-fit: cover; border: 2px solid #ff8c00; border-radius: 8px; box-shadow: 0 0 10px rgba(255,140,0,.3); }
        .company-name { font-size: 20px; font-weight: 700; color: #ff8c00; }

        /* Dashboard */
        .dashboard { display:none; width:100%; min-height:100vh; background:linear-gradient(135deg,#0c0c0c 0%,#1a1a2e 100%); color:#f0f0f0; padding:20px; }
        .dashboard-header { display:flex; justify-content:space-between; align-items:center; padding:20px; background:rgba(20,20,30,.8); border-radius:15px; margin-bottom:30px; box-shadow:0 10px 25px rgba(0,0,0,.3); }
        .welcome-message { font-size:24px; font-weight:600; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); -webkit-background-clip:text; background-clip:text; color:transparent; }
        .dashboard-logout { padding:10px 20px; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); border:none; border-radius:8px; color:#1a1a2e; font-size:16px; font-weight:600; cursor:pointer; transition:all .3s ease; display:flex; align-items:center; gap:8px; }
        .dashboard-logout:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(100,255,150,.4); }

        /* Dashboard Content */
        .dashboard-content { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; padding:20px; }
        .dashboard-card { background:rgba(20,20,30,.8); border-radius:15px; padding:20px; box-shadow:0 10px 25px rgba(0,0,0,.3); transition:transform .3s ease; text-align:center; cursor:pointer; }
        .dashboard-card:hover { transform:translateY(-5px); }
        .dashboard-card h3 { font-size:18px; margin-bottom:10px; color:#a0f0c0; }
        .dashboard-card p { color:#b0b0d0; line-height:1.6; }

        /* Task Management */
        .task-management { background:rgba(20,20,30,.8); border-radius:15px; padding:20px; box-shadow:0 10px 25px rgba(0,0,0,.3); margin-top:20px; grid-column: 1 / -1; }
        .task-management h3 { font-size:18px; margin-bottom:15px; color:#a0f0c0; }
        .task-list { list-style-type: none; padding: 0; }
        .task-item { background: rgba(30,30,46,.7); padding: 12px; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .task-item.completed { opacity: 0.7; text-decoration: line-through; }
        .task-actions { display: flex; gap: 10px; }
        .task-btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .task-btn.complete { background: #64ff96; color: #1a1a2e; }
        .task-btn.delete { background: #ff6464; color: white; }
        .add-task { display: flex; gap: 10px; margin-top: 15px; }
        .add-task input { flex: 1; padding:10px; background:rgba(40,40,60,.8); border:1px solid #4a4a7a; border-radius:8px; color:#f0f0f0; }
        .add-task button { background: #64ff96; color: #1a1a2e; border: none; border-radius: 8px; padding: 10px 15px; cursor: pointer; font-weight: 600; }

        /* Main Web Button */
        .main-webpage-btn { 
            display: block; margin: 30px auto 0; padding: 18px 30px; 
            background: linear-gradient(135deg, #ff8c00 0%, #ff5e00 100%); 
            color: white; font-size: 20px; font-weight: 700; border: none; 
            border-radius: 15px; cursor: pointer; box-shadow: 0 8px 25px rgba(255,140,0,.4); 
            transition: all .3s ease; text-align: center; text-decoration: none;
            display: flex; align-items: center; justify-content: center; gap: 12px;
            max-width: 400px;
        }
        .main-webpage-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 12px 30px rgba(255,140,0,.6); 
        }
        .main-webpage-btn i { font-size: 24px; }

        @media (max-width:768px){
            .container{flex-direction:column;width:90%;height:auto;}
            .camera-section{padding:40px 0;}
            .login-section{padding:20px;}
            .dashboard-header{flex-direction:column;gap:15px;text-align:center;}
            .company-logo-container { position: relative; top: 0; left: 0; justify-content: center; margin-bottom: 20px; }
            .main-webpage-btn { font-size: 18px; padding: 16px 24px; }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="container" id="loginPage">
        <div class="company-logo-container">
            <img src="https://raw.githubusercontent.com/bimal-bp/Work_plan/main/Company_logo" alt="Company Logo" class="company-logo">
        </div>
       
        <div class="camera-section">
            <div class="camera-container">
                <video id="cameraPreview" autoplay muted playsinline></video>
                <div class="capture-overlay" id="captureOverlay">
                    <div class="capture-animation"></div>
                </div>
            </div>
            <div class="camera-info">Camera will capture your photo upon login</div>
            <div class="location-status waiting" id="locationStatus">
                <div class="spinner"></div> Getting your location…
            </div>
            <div class="location-options" id="locationOptions" style="display:none;">
                <button class="location-option" id="retryLocation">
                    <i class="fas fa-redo"></i> Retry High Accuracy Location
                </button>
                <button class="location-option" id="useApproximateLocation">
                    <i class="fas fa-map-marker-alt"></i> Use Approximate Location
                </button>
                <button class="location-option" id="skipLocation">
                    <i class="fas fa-forward"></i> Skip Location (Limited Access)
                </button>
            </div>
        </div>
        <div class="login-section">
            <div class="decoration"></div>
            <div class="decoration"></div>
            <h1 class="company-title">SGX MINERALS PVT LTD</h1>
            <p class="company-subtitle">Resource Management System</p>
            <form class="login-form" id="loginForm">
                <h2>Welcome Back</h2>
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="login-btn" id="loginBtn" disabled>
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <div class="forgot-password"><a href="#">Forgot Password?</a></div>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="dashboard" id="dashboardPage">
        <div class="dashboard-header">
            <div class="welcome-message" id="welcomeMessage">Welcome, Bimal Patra!</div>
            <button class="dashboard-logout" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <div class="dashboard-content">
            <!-- Daily Production & Dispatch -->
            <div class="dashboard-card" id="productionDashboardBtn">
                <h3>Daily Production & Dispatch</h3>
                <p>Monitor daily production metrics and dispatch planning.</p>
            </div>

            <!-- Task Management -->
            <div class="task-management">
                <h3>Task Management</h3>
                <p>Manage your daily tasks and assignments.</p>
                <div class="add-task">
                    <input type="text" id="newTaskInput" placeholder="Enter a new task...">
                    <button id="addTaskBtn">Add Task</button>
                </div>
                <ul class="task-list" id="taskList"></ul>
            </div>

            <!-- 5 Boxes -->
            <div class="dashboard-card">
                <h3>Quarry</h3>
                <p>Monitor quarry operations and output</p>
            </div>
            <div class="dashboard-card">
                <h3>Plant Maintenance</h3>
                <p>Track plant status and maintenance schedule</p>
            </div>
            <div class="dashboard-card">
                <h3>Arun Sir</h3>
                <p>Tasks assigned by Arun Sir</p>
            </div>
            <div class="dashboard-card">
                <h3>Jagan Sir</h3>
                <p>Tasks assigned by Jagan Sir</p>
            </div>

            <!-- Main Web Button -->
            <a href="https://bimal-bp.github.io/SGX_Aggregate_WEB/" target="_blank" class="main-webpage-btn">
                <i class="fas fa-globe"></i> View Main Website
            </a>
        </div>
    </div>

    <!-- Production Dashboard (Hidden) -->
    <div id="productionDashboard" style="display: none; background-color: #f3f4f6; font-family: sans-serif; padding: 20px; min-height: 100vh;">
        <!-- Full production dashboard content (same as before) -->
        <!-- Omitted for brevity, but included in full code below -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // DOM Elements
            const loginPage = document.getElementById('loginPage');
            const dashboardPage = document.getElementById('dashboardPage');
            const productionDashboard = document.getElementById('productionDashboard');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const logoutBtn = document.getElementById('logoutBtn');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const cameraPreview = document.getElementById('cameraPreview');
            const captureOverlay = document.getElementById('captureOverlay');
            const locationStatus = document.getElementById('locationStatus');
            const locationOptions = document.getElementById('locationOptions');
            const retryBtn = document.getElementById('retryLocation');
            const approxBtn = document.getElementById('useApproximateLocation');
            const skipBtn = document.getElementById('skipLocation');
            const productionDashboardBtn = document.getElementById('productionDashboardBtn');
            const backToDashboardBtn = document.getElementById('backToDashboardBtn');

            // Task Management
            const newTaskInput = document.getElementById('newTaskInput');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const taskList = document.getElementById('taskList');

            // State
            let currentStream = null;
            let isCameraActive = false;
            let userLocation = null;
            let locationAcquired = false;
            let locationType = 'none';

            // Employee DB
            const employees = {
                'sgxminerals': { password: 'admin123', name: 'Bimal Patra', role: 'Operations Manager' },
            };
            usernameInput.value = 'sgxminerals';
            passwordInput.value = 'admin123';

            // Camera
            function startCamera() {
                if (currentStream) stopCamera();
                navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                .then(stream => {
                    currentStream = stream;
                    cameraPreview.srcObject = stream;
                    isCameraActive = true;
                })
                .catch(err => alert('Camera access denied.'));
            }
            function stopCamera() {
                if (currentStream) {
                    currentStream.getTracks().forEach(t => t.stop());
                    currentStream = null;
                }
            }

            // Location
            function requestLocation() {
                locationStatus.innerHTML = '<div class="spinner"></div> Getting your location…';
                locationStatus.className = 'location-status waiting';
                locationOptions.style.display = 'none';
                loginBtn.disabled = true;

                if (!navigator.geolocation) {
                    locationFailed('Geolocation not supported.');
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    pos => {
                        userLocation = { lat: pos.coords.latitude, lon: pos.coords.longitude };
                        locationAcquired = true;
                        locationType = 'high';
                        loginBtn.disabled = false;
                        locationStatus.innerHTML = '<i class="fas fa-check-circle"></i> Location captured';
                        locationStatus.className = 'location-status success';
                    },
                    err => {
                        locationFailed('Location failed. Try approximate or skip.');
                    },
                    { enableHighAccuracy: true, timeout: 15000 }
                );
            }

            function locationFailed(msg) {
                locationStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${msg}`;
                locationStatus.className = 'location-status error';
                locationOptions.style.display = 'flex';
            }

            function useApproximateLocation() {
                fetch('https://ipapi.co/json/')
                .then(r => r.json())
                .then(data => {
                    userLocation = { lat: data.latitude, lon: data.longitude };
                    locationAcquired = true;
                    locationType = 'approximate';
                    loginBtn.disabled = false;
                    locationStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Approximate location';
                    locationStatus.className = 'location-status warning';
                    locationOptions.style.display = 'none';
                });
            }

            function skipLocation() {
                locationAcquired = false;
                locationType = 'none';
                loginBtn.disabled = false;
                locationStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Location skipped';
                locationStatus.className = 'location-status warning';
                locationOptions.style.display = 'none';
            }

            // Capture Image
            async function captureImage() {
                if (!isCameraActive) return null;
                captureOverlay.classList.add('active');
                await new Promise(r => setTimeout(r, 800));
                const canvas = document.createElement('canvas');
                canvas.width = 640; canvas.height = 480;
                canvas.getContext('2d').drawImage(cameraPreview, 0, 0, 640, 480);
                const dataUrl = canvas.toDataURL('image/jpeg');
                captureOverlay.classList.remove('active');
                return dataUrl;
            }

            // Login
            async function handleLogin() {
                const username = usernameInput.value.trim();
                const password = passwordInput.value;
                if (employees[username] && employees[username].password === password) {
                    const photo = await captureImage();
                    loginPage.style.display = 'none';
                    dashboardPage.style.display = 'block';
                    welcomeMessage.textContent = `Welcome, ${employees[username].name}!`;
                } else {
                    alert('Invalid credentials. Use: sgxminerals / admin123');
                }
            }

            // Logout
            function logout() {
                loginPage.style.display = 'flex';
                dashboardPage.style.display = 'none';
                productionDashboard.style.display = 'none';
                usernameInput.value = 'sgxminerals';
                passwordInput.value = 'admin123';
                startCamera();
                requestLocation();
            }

            // Task Management
            function loadTasks() {
                const saved = localStorage.getItem('sgxTasks');
                if (saved) taskList.innerHTML = saved;
                attachTaskListeners();
            }
            function saveTasks() { localStorage.setItem('sgxTasks', taskList.innerHTML); }
            function addTask() {
                const text = newTaskInput.value.trim();
                if (!text) return;
                const id = 'task-' + Date.now();
                const li = document.createElement('li');
                li.className = 'task-item';
                li.id = id;
                li.innerHTML = `<span>${text}</span><div class="task-actions">
                    <button class="task-btn complete" data-id="${id}">Complete</button>
                    <button class="task-btn delete" data-id="${id}">Delete</button>
                </div>`;
                taskList.appendChild(li);
                newTaskInput.value = '';
                saveTasks();
                attachTaskListeners();
            }
            function attachTaskListeners() {
                document.querySelectorAll('.task-btn').forEach(btn => {
                    btn.onclick = function() {
                        const id = this.dataset.id;
                        const task = document.getElementById(id);
                        if (this.classList.contains('complete')) {
                            task.classList.toggle('completed');
                        } else {
                            task.remove();
                        }
                        saveTasks();
                    };
                });
            }

            // Navigation
            productionDashboardBtn.addEventListener('click', () => {
                dashboardPage.style.display = 'none';
                productionDashboard.style.display = 'block';
            });
            if (backToDashboardBtn) {
                backToDashboardBtn.addEventListener('click', () => {
                    productionDashboard.style.display = 'none';
                    dashboardPage.style.display = 'block';
                });
            }

            // Events
            loginForm.addEventListener('submit', e => { e.preventDefault(); handleLogin(); });
            logoutBtn.addEventListener('click', logout);
            retryBtn.addEventListener('click', requestLocation);
            approxBtn.addEventListener('click', useApproximateLocation);
            skipBtn.addEventListener('click', skipLocation);
            addTaskBtn.addEventListener('click', addTask);
            newTaskInput.addEventListener('keypress', e => { if (e.key === 'Enter') addTask(); });

            // Init
            startCamera();
            requestLocation();
            loadTasks();

            // Glow effect
            [usernameInput, passwordInput].forEach(input => {
                input.addEventListener('focus', () => loginForm.classList.add('glow'));
                input.addEventListener('blur', () => {
                    if (!usernameInput.matches(':focus') && !passwordInput.matches(':focus')) {
                        loginForm.classList.remove('glow');
                    }
                });
            });
        });
    </script>
</body>
</html>
